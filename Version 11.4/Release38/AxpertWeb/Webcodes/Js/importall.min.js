/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function ownKeys(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),l.push.apply(l,a)}return l}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(l),!0).forEach(function(t){_defineProperty(e,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):ownKeys(Object(l)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))})}return e}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,a=new Array(t);l<t;l++)a[l]=e[l];return a}function _iterableToArrayLimit(e,t){var l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=l){var a,r,n=[],o=!0,i=!1;try{for(l=l.call(e);!(o=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(s){i=!0,r=s}finally{try{o||null==l["return"]||l["return"]()}finally{if(i)throw r}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var placement,ignoredColCount=0,ignoredColumns=[],oldSelectedValues=0,isFormDirty=!1,leftSelectedClickedOnce=!1,impTempObj={},filenameuploaded="",selectedValuesheets,arraysByDC,filenameXl,sheetHeaders={},oldValue,fileUrl,impXlimportCol;function validateDataSearchWiz(){var ddl=0,multiselect=0;if("NA"!=$("#ddlImpTbl").val())if(ddl=1,$("#mSelectRight option").val()!=undefined&&$("#mSelectRight option").val().length>0){var mandatoryField=!1;$("#mSelectLeft option").each(function(){$(this).val().indexOf("*")>=0&&(mandatoryField=!0)}),mandatoryField?(showAlertDialog("warning",eval(callParent("lcm[156]"))),$("#mSelectLeft").focus()):multiselect=1}else $("#dataupdatecheck").is(":checked")?(showAlertDialog("warning",eval(callParent("lcm[531]"))),$("#primaryfld").focus()):(showAlertDialog("warning",eval(callParent("lcm[108]"))),$("#mSelectLeft").focus());else showAlertDialog("warning",eval(callParent("lcm[106]"))),$("#ddlImpTbl").data("selectpicker").$button.focus();if(1==ddl&&1==multiselect){var tempColNames="",tempColValues="";$("#mSelectRight option").each(function(){tempColNames+=$(this).text()+", ",tempColValues+=$(this).val()+", "}),tempColNames=tempColNames.substring(0,tempColNames.length-2),tempColValues=tempColValues.substring(0,tempColValues.length-2),selectedValues=$("#mSelectRight option").length,0!=oldSelectedValues&&selectedValues!=oldSelectedValues?($("#noFile").text(eval(callParent("lcm[66]"))),$("#fileToUpload").val("").prop("title",eval(callParent("lcm[66]"))),$("#IsFileUploaded").val(""),$("#divProgress").hide(),oldSelectedValues=0):$("#hdnSelectedColumnCount").val(selectedValues),$("#hdnColNames").val(tempColNames),$("#hdnColValues").val(tempColValues),tempFileName=$("#ddlImpTbl :selected").text(),hdnTemplateName=$("#hdnTemplateName").val(),$("#excel1").click(function(){""==hdnTemplateName&&(hdnTemplateName=$("#ddlImpTbl :selected").text()),$("#hdnTemplateName").val(hdnTemplateName+".xlsx"),$("#btnCreateTemplate").click()}),$("#CSV1").click(function(){""==hdnTemplateName&&(hdnTemplateName=$("#ddlImpTbl :selected").text()),$("#hdnTemplateName").val(hdnTemplateName+".csv"),$("#btnCreateTemplate").click()}),$("#ddlGroupBy").empty().append("<option value='NA'>-- Select --</option"),colValues=$("#hdnGroupByColVal").val().split(", "),colNames=$("#hdnGroupByColName").val().split(", ");for(var i=0;i<colNames.length;i++)$("#ddlGroupBy").append("<option value='"+colValues[i]+"'>"+colNames[i]+"</option");return $("#ddlGroupBy").change(function(){$("#hdnGroupBy").val($("#ddlGroupBy").val())}),!0}return!1}function FileuplaodValidation(){try{$.ajax({url:"importnew.aspx/FileuplaodValidation",type:"POST",cache:!1,async:!0,dataType:"json",contentType:"application/json",success:function(e){e.d},error:function(e){}})}catch(e){}}function generateHTML(e,t){var l=document.getElementById("xlnum");impXlimportCol=t,$("#gridImpData th select").each(function(e,l){$(l).val(t[0][e]).trigger("change")});var a=e.split(","),r="";a.forEach(function(e,l){t[l].forEach(function(a,n){r+=e+".col"+(n+1)+"="+a,n<t[l].length-1&&(r+=", ")}),l<a.length-1&&(r+=" <br>")}),l.innerHTML=r,$("#xlnum").addClass("form-control"),$("#mulForm").is(":checked")&&$("#xlnum").addClass("d-none")}function addSheetRow1(){var e=$("<div>").addClass("sheetRow"),t=$("<section>").addClass("form-group col-md-12 mb-4").text("xlfileafterupload");e.append(t);var l=$("#hdnformQueue").val().split(","),a=$("<label>").attr("for","selectform").text("Map Form:").addClass("form-label col-form-label pb-1 fw-boldest mb-4");function r(e,t,l){var a=$("#hdnformQueueVal").val().split(","),r=$("<select>").addClass("sheetselect form-select forValidation selectpicker mb-4").attr("id",l);return r.append($("<option>").text(e).attr("disabled",!0).attr("selected",!0)),t.forEach(function(e,t){r.append($("<option>").text(e).attr("value",a[t]))}),"Choose Group By"===e&&r.prop("disabled",!0),r}var n=r("Choose Form",l,"selectform"),o=r("Choose Primary Key",[],"selectPrimaryKey");$("#btnSaveTemplateXl").after(o).after(n);var i=$("<div>").addClass("d-flex align-items-center mb-3");$("#selectform").appendTo(i),$("#btnSaveTemplateXl").appendTo(i),i.prependTo(".controls"),$(".controls").prepend($("#axstaysigninforms"));var s=$("<div>").append(a);$("#myButton").next().before(s),$("#dropdownsContainer").append(e),$("#selectform").on("select2:select",function(e){var t=this,l=$(this).val(),a=$(this)[0].id;(a[a.length-1]-1).toString();$(this).select2("close"),$.ajax({url:"ImportAll.aspx/GetFields",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:l}),dataType:"json",contentType:"application/json",success:function(e){var l=JSON.parse(e.d);$("#hdnFname").val($("#select2-selectform-container").text()+"("+$("#selectform").val()+")");var a=l.VisibleTstFlds.m_StringValue,r=l.visibleTstFldsGridDc.m_StringValue.slice(0,-1).split(","),n={};r.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];n[a]||(n[a]=[]),n[a].push(l)});var o=Object.entries(n).map(function(e){var t=_slicedToArray(e,2);t[0];return{fields:t[1]}}),i=l.visibleTstFldsNonGriddc.m_StringValue.slice(0,-1).split(","),s={};i.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];s[a]||(s[a]=[]),s[a].push(l)});var c=Object.entries(s).map(function(e){var t=_slicedToArray(e,2);t[0];return{fields:t[1]}}),d=[].concat(_toConsumableArray(c),_toConsumableArray(o));d.sort(function(e,t){return parseInt(e.dc)-parseInt(t.dc)}),(arraysByDC=d.map(function(e){return e.fields})).forEach(function(e,t){console.log("Array for DC ".concat(d[t].dc,":"),e)});var p=(a=l.VisibleTstFlds.m_StringValue).indexOf(",♠"),m="";-1!==p&&(m=a.substring(0,p),a.substring(p+",♠".length));var u=m.split(",");$("#hdnFieldnamesExcelnew").val(m),$(t).select2("close");$("#selectPrimaryKey").empty(),u.forEach(function(e){$("#selectPrimaryKey").append($("<option></option>").attr("value",e).text(e))}),$("#selectPrimaryKey").select2()},error:function(e,t,l){console.error("AJAX error:",l),$(this).select2("close")}})})}function getHeadersForSheet(){var e=document.getElementById("gridImpData"),t=[];if(e){var l=e.querySelector("tr");if(l)l.querySelectorAll("th").forEach(function(e){var l=e.querySelector("select");l&&l.options[l.selectedIndex]&&t.push(l.options[l.selectedIndex].text)})}sheetHeaders[parseInt($("#selectsheet").val())+1]=t;var a=JSON.stringify(sheetHeaders);return document.getElementById("hdndheetheaders").value=a,t}function countSheets(e,t){if(!$("#mulForm").is(":checked")){$(".sheetselect").select2(),$(".importrecord").removeClass("d-none"),filenameuploaded=t+"-"+filename;for(var l=parseInt(e),a=$("<label>").attr("for","selectsheet").text("Select Sheet:").addClass("form-label col-form-label pb-1 fw-boldest mb-4"),r=$("<select>").attr("id","selectsheet").addClass("sheetname form-select forValidation selectpicker mb-4"),n=1;n<=l;n++){var o=$("<option>").val(n-1).text("Sheet "+n);r.append(o)}$("#selectsheet").select2(),$("#checksheets #selectsheet").length>0?($("#checksheets #selectsheet").replaceWith(r),$('#checksheets label[for="selectsheet"]').replaceWith(a)):$("#checksheets").append(a).append(r),$("#selectsheet").select2();var i=$("#btngridxl");$("#btngridxl").removeClass("d-none"),$("#checksheets").append(i),$("#checksheets #headertip").length>0&&$("#checksheets #headertip").remove(),$("#checksheets").append('<span tabindex="0" class="material-icons material-icons-style material-icons-3 icon-arrows-question col-info" data-bs-toggle="tooltip" id="headertip" data-bs-original-title="Please Map all the coloumns of every sheet if you are uploading file without headers" data-bs-placement="bottom" data-bs-dismiss="click">help_outline</span>'),$("#selectsheet").on("select2:opening",function(){oldValue=$(this).val()}),$.ajax({url:"ImportAll.aspx/GetSheets",type:"POST",cache:!1,async:!1,data:JSON.stringify({sheetname:"0",filename:filenameuploaded,xlhasheader:$("#hdnxlHasHeader").val()}),dataType:"json",contentType:"application/json",success:function(e){if(e.d){var t=JSON.parse(e.d),l=t.Headers,a=JSON.parse(t.Data),r=$("#selectPrimaryKey").val();r=""!=r&&r.includes("(")?r:$("#hdnFnameKey").val(),arraysByDC.forEach(function(e){e[0]!==r&&e.unshift(r)}),getHeadersForSheet();var n=parseInt(oldValue)+1;sheetHeaders[n]=getHeadersForSheet();var o=JSON.stringify(sheetHeaders);document.getElementById("hdndheetheaders").value=o;var i=l.split(/[,()]/),s=i.filter(function(e,t){return t%2==0}).join(","),c=l.split(","),d=i.filter(function(e,t){return t%2!=0}).join(","),p=((parseInt(selectedValuesheets)+1).toString(),(parseInt(selectedValuesheets)+1).toString(),"<table class='table w-100' id='gridImpData'><thead><tr>");if(""!=$("#hdnxlHasHeader").val()&&"false"==$("#hdnxlHasHeader").val())for(var m=0;m<Object.keys(a[0]).length;m++)p+="<th>"+arraysByDC[0][m]+"</th>";else for(var u in a[0])p+="<th>"+u+"</th>";p+="</tr></thead><tbody>",a.forEach(function(e){for(var t in p+="<tr>",e)p+="<td>"+e[t]+"</td>";p+="</tr>"}),p+="</tbody></table>",$("#UpdateGrid").html(p),""!=$("#hdnxlHasHeader").val()&&"false"==$("#hdnxlHasHeader").val()?$("#gridImpData thead th").each(function(e){for(var t=arraysByDC[0].toString().split(/[,()]/).filter(function(e,t){return t%2!=0}).join(",").split(",").map(function(e){return e.trim()}).filter(function(e){return e}),l=$("<select>").attr("id","ddlColumnName"+e).addClass("form-control"),a=0;a<t.length;a++)l.append($("<option>").val(t[a]).text(arraysByDC[0][a]));var r=$(this).text(),n=t;0==ChkColNameInfile.checked?n[e]&&l.val(n[e]):l.val(r),$(this).html(l)}):$("#gridImpData thead th").each(function(e){for(var t=s.split(",").map(function(e){return e.trim()}).filter(function(e){return e}),l=d.split(",").map(function(e){return e.trim()}).filter(function(e){return e}),a=$("<select>").attr("id","ddlColumnName"+e).addClass("form-control"),r=0;r<t.length;r++)a.append($("<option>").val(l[r]).text(c[r]));var n=$(this).text(),o=l;0==ChkColNameInfile.checked?o[e]&&a.val(o[e]):a.val(n),$(this).html(a)}),addChkbxsToGrdColumns()}},error:function(e,t,l){console.error("AJAX error:",l)}}),$("#selectsheet").on("change",function(){selectedValuesheets=$(this).val(),$.ajax({url:"ImportAll.aspx/GetSheets",type:"POST",cache:!1,async:!1,data:JSON.stringify({sheetname:selectedValuesheets,filename:filenameuploaded,xlhasheader:$("#hdnxlHasHeader").val()}),dataType:"json",contentType:"application/json",success:function(e){if(e.d){var t=JSON.parse(e.d),l=t.Headers,a=JSON.parse(t.Data),r=$("#selectPrimaryKey").val();r=""!=r&&r.includes("(")?r:$("#hdnFnameKey").val(),arraysByDC.forEach(function(e){e[0]!==r&&e.unshift(r)});var n=parseInt(oldValue)+1;sheetHeaders[n]=function(){var e=document.getElementById("gridImpData"),t=[];if(e){var l=e.querySelector("tr");l&&l.querySelectorAll("th").forEach(function(e){var l=e.querySelector("select");if(l){var a=l.options[l.selectedIndex];t.push(a.text)}})}return t}();var o=JSON.stringify(sheetHeaders);document.getElementById("hdndheetheaders").value=o;var i=l.split(/[,()]/),s=i.filter(function(e,t){return t%2==0}).join(","),c=l.split(","),d=i.filter(function(e,t){return t%2!=0}).join(","),p=((parseInt(selectedValuesheets)+1).toString(),(parseInt(selectedValuesheets)+1).toString(),"<table class='table w-100' id='gridImpData'><thead><tr>");if(""!=$("#hdnxlHasHeader").val()&&"false"==$("#hdnxlHasHeader").val())for(var m=0;m<arraysByDC[selectedValuesheets].length;m++)p+="<th>"+arraysByDC[selectedValuesheets][m]+"</th>";else if(0===a.length)for(var u=l.split(",").map(function(e){return e.trim()}).filter(function(e){return e}),f=0;f<u.length;f++)p+="<th>"+u[f]+"</th>";else for(var h in a[0])p+="<th>"+h+"</th>";p+="</tr></thead><tbody>",a.forEach(function(e){for(var t in p+="<tr>",e)p+="<td>"+e[t]+"</td>";p+="</tr>"}),p+="</tbody></table>",$("#UpdateGrid").html(p),""!=$("#hdnxlHasHeader").val()&&"false"==$("#hdnxlHasHeader").val()?$("#gridImpData thead th").each(function(e){for(var t=arraysByDC[selectedValuesheets].toString().split(/[,()]/).filter(function(e,t){return t%2!=0}).join(",").split(",").map(function(e){return e.trim()}).filter(function(e){return e}),l=$("<select>").attr("id","ddlColumnName"+e).addClass("form-control"),a=0;a<t.length;a++)l.append($("<option>").val(t[a]).text(arraysByDC[selectedValuesheets][a]));var r=$(this).text(),n=t;0==ChkColNameInfile.checked?n[e]&&l.val(n[e]):l.val(r),$(this).html(l)}):$("#gridImpData thead th").each(function(e){for(var t=s.split(",").map(function(e){return e.trim()}).filter(function(e){return e}),l=d.split(",").map(function(e){return e.trim()}).filter(function(e){return e}),a=$("<select>").attr("id","ddlColumnName"+e).addClass("form-control"),r=0;r<t.length;r++)a.append($("<option>").val(l[r]).text(c[r]));var n=$(this).text(),o=l;0==ChkColNameInfile.checked?o[e]&&a.val(o[e]):a.val(n),$(this).html(a)}),addChkbxsToGrdColumns()}},error:function(e,t,l){console.error("AJAX error:",l)}})}),$(".sheetselect").select2(),$(".multiselect").select2()}}function validateDataUploadWiz(){var uploadMsg=$("#hdnUploadFileWarnings").val();if("1"==$("#IsFileUploaded").val())return ChkAllowUpdate(),!0;if("Empty"==uploadMsg)return showAlertDialog("warning",4036,"client"),!1;if("NotEqualColumns"==uploadMsg)return showAlertDialog("warning",4039,"client"),!1;if("DuplicateColumns"==uploadMsg)return showAlertDialog("warning",eval(callParent("lcm[307]"))),!1;if("InvalidFileFormat"==uploadMsg)return showAlertDialog("warning",eval(callParent("lcm[310]"))),!1;fileupload=1;var errorMesg=$(".fileUploadErrorMessage").text();return errorMesg.indexOf("csv")<0&&showAlertDialog("warning",eval(callParent("lcm[113]"))),$("#fileuploadsts").text(""),!1}function GetSelColData(){var e=[],t=[];$("#gridImpData tr >th select:not([disabled])").each(function(){var l=$(this).find(":selected").val(),a=$(this).find(":selected").text();"None"==l?e.push("None"):(e.push(l),t.push(a))});for(var l=e.slice().sort(),a=[],r=0;r<e.length-1;r++)l[r+1]==l[r]&&a.push(l[r]);if(a.length>0)return showAlertDialog("warning",1030,"client"),focusSelectInGrid(e,a),!1;var n="",o="";return $("#gridImpData tr th").find("select:not([disabled])").each(function(){n+=$(this).find("option[selected]").text()+", ",o+=$(this).val()+", "}),n=n.substring(0,n.length-2),o=o.substring(0,o.length-2),$("#hdnColNames").val(n),$("#hdnColValues").val(o),$("#colheader").val(e.join(",")),$("#colHeaderNames").val(t.join(",")),unselectIgnoredColumns(),!$("#chkForAllowUpdate").prop("checked")||(primaryKeyCol=$("#ddlPrimaryKey").val(),"NA"==primaryKeyCol?(showAlertDialog("warning","Please select Primary Key column"),$("#ddlPrimaryKey").focus(),!1):($("#hdnPrimaryKey").val(primaryKeyCol),!0))}function updateMandatoryFieldsToSelection(){$("#mSelectLeft option").each(function(){$(this).text().indexOf("*")>=0?($("#mSelectRight").append($("<option>",{value:$(this).val(),text:$(this).text(),mandatory:!0})),$(this).remove()):$(this).attr("mandatory",!1)})}function updateMandatoryFieldsInTemplate(){$("#mSelectLeft option, #mSelectRight option").each(function(e,t){$(t).text().indexOf("*")>=0?$(t).attr("mandatory",!0):$(t).attr("mandatory",!1)})}function ChkAllowUpdate(){if($("#chkForAllowUpdate").prop("checked")){$("#lblprimarycolmn,#ddlPrimaryKey").parent("div").removeClass("d-none"),$("#ddlPrimaryKey").empty(),$("#ddlPrimaryKey").append("<option value='NA'>-- Select --</option"),colValues=$("#hdnColValues").val().split(", "),colNames=$("#hdnColNames").val().split(", ");for(var e=0;e<colNames.length;e++)$("#ddlPrimaryKey").append("<option value='"+colValues[e]+"'>"+colNames[e]+"</option");disabledIgnoredColumns(ignoredColCount)}else $("#lblprimarycolmn,#ddlPrimaryKey").parent("div").addClass("d-none")}function ColNameInfileChanged(){}function focusSelectInGrid(e,t){var l=[];for(i=0;i<t.length;i++)for(j=0;j<e.length;j++)t[i]==e[j]&&l.push(j);for(i=0;i<l.length;i++)1==i&&$("#gridImpData tbody tr th").eq(l[i]).find("select").focus()}function uploadFileChangeEvent(){$("#fileToUpload").change(function(e){var uploadControl=$("#fileToUpload")[0].files[0],regex=/^.*\.(CSV|csv|txt|TXT|XLS|xls|XLSX|xlsx)$/;if(uploadControl!=undefined){var Filename=uploadControl.name;if(""!=Filename){var fileSize=uploadControl.size/1024/1024;regex.test(Filename)?fileSize>1?(showAlertDialog("warning",eval(callParent("lcm[156]"))),$("#noFile").text(eval(callParent("lcm[66]"))),$("#fileToUpload").val(""),$("#IsFileUploaded").val("")):($("#noFile").text(Filename),$("#chkForAllowUpdate").attr("checked",!1),$("#hdnPrimaryKey").val(""),ChkAllowUpdate(),$("#btnFileUpload").click()):(showAlertDialog("warning",eval(callParent("lcm[157]"))),uploadControl.value="",$("#noFile").text(eval(callParent("lcm[66]"))),$("#fileToUpload").val(""),$("#IsFileUploaded").val(""))}}else $("#noFile").text(eval(callParent("lcm[66]"))),$("#IsFileUploaded").val("")})}function uploadFileClickEvent(){$("#btnFileUpload").click(function(){var fileUpload=$("#fileToUpload").get(0),files=fileUpload.files,frm=new FormData;if(0==files.length)showAlertDialog("warning",eval(callParent("lcm[158]")));else{for(var i=0;i<files.length;i++)frm.append(files[i].name,files[i]);$(".progress").show();var url=location.origin+location.pathname.substr(0,location.pathname.indexOf("aspx"));$.ajax({url:url+"FileUploadHandler.ashx",type:"POST",contentType:!1,processData:!1,data:frm,success:function(e){if(0==e.indexOf("File Uploaded successfully")){var t=e.substr(e.indexOf("&&")+2);$("#divProgressBar").removeClass("progress-bar-danger"),setTimeout(function(){$("#divProgressBar").removeClass("progress-bar progress-bar-striped active").addClass("progress-bar-success").text("100%").css("width","100%").attr("aria-valuenow","100")},500),$("#upFileName").val(t),$("#uploadFileName").val(files[0].name),$("#UploadButton").click()}else showAlertDialog("warning",e)},error:function error(err){showAlertDialog("warning",eval(callParent("lcm[159]"))),$("#divProgressBar").removeClass("progress-bar-striped active").addClass("progress-bar-danger").text("0%").css("width","100%").attr("aria-valuenow","100")},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){var t=0,l=e.loaded||e.position,a=e.total;e.lengthComputable&&(t=Math.ceil(l/a*100)),$("#divProgressBar").addClass("progress-bar-striped").text(t+"%").css("width","100%").attr("aria-valuenow",t)},e}})}})}function openTableInBSModal(){var e=document.getElementById("tableModal");if(!e){document.body.insertAdjacentHTML("beforeend",'\n            <div class="modal fade" id="tableModal" tabindex="-1" aria-labelledby="tableModalLabel" aria-hidden="true">\n                <div class="modal-dialog" style="max-width: 90vw; max-height: 90vh;">\n                    <div class="modal-content">\n                        <div class="modal-header" style="max-height: 40px;margin-top : 10px">\n                            <h5 class="modal-title" id="tableModalLabel">Map Columns</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <div class="modal-body" style="max-height: 62vh; overflow-y: auto;">\n                            \x3c!-- Table will be placed directly here --\x3e\n                        </div>\n                        <div class="modal-footer" style="max-height: 60px;">\n                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" style="position:relative;top:-13px;">Close</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),e=document.getElementById("tableModal")}var t=e.querySelector(".modal-body"),l=document.getElementById("UpdateGrid");l&&t.appendChild(l),new bootstrap.Modal(e).show()}function fileUploadSuccess(){showAlertDialog("success",4037,"client");var e=$("#uploadFileName").val();$(".dropzone-select").text(e).addClass("col-10"),uploadFileClickEvent(),uploadFileChangeEvent(),addChkbxsToGrdColumns(),disabledIgnoredColumns(ignoredColCount=parseInt($("#hdnIgnoredColCount").val())),unselectIgnoredColumns(),showPopover(),filename=$("#uploadFileName").val(),$("#noFile").text(filename),$("#fileToUpload").attr("title",filename)}function createMultiselectControl(){$(".multiselect").multiselect({beforeMoveToLeft:function(e,t,l){return!1},sort:!0,moveToLeft:function moveToLeft(Multiselect,$options,event,silent,skipStack){targetId=$(event.target).attr("id");var selectionOptionCount=0;if(1==$options.length)if($("#dataupdatecheck").is(":checked")){if($("#tstFlds").val()!=$options.text())return $("#mSelectLeft").append($("<option>",{value:$options.val(),text:$options.text(),mandatory:!1})),$options.remove(),!0}else{if("false"==$options.attr("mandatory"))return $("#mSelectLeft").append($("<option>",{value:$options.val(),text:$options.text(),mandatory:!1})),$options.remove(),!0;showAlertDialog("warning",eval(callParent("lcm[160]")))}else"left_Selected_1"==targetId&&($("#mSelectRight :selected").map(function(e,t){"true"==$(t).attr("mandatory")&&selectionOptionCount++}),selectionOptionCount==$options.length&&showAlertDialog("warning",eval(callParent("lcm[161]"))));var mandatoryCount=0;if($("#mSelectRight option").map(function(e,t){"true"==$(t).attr("mandatory")&&mandatoryCount++}),$("#dataupdatecheck").is(":checked")){var selectOrAll="left_All_1"==$(event.currentTarget).attr("id")?"option":":selected";$("#mSelectRight "+selectOrAll).map(function(e,t){$("#tstFlds").val()!=$(this).text()&&($("#mSelectLeft").append($("<option>",{value:$(this).val(),text:$(this).text(),mandatory:!1})),$(this).remove())})}else if(mandatoryCount>1&&mandatoryCount==$options.length)showAlertDialog("warning",eval(callParent("lcm[161]")));else{var selectOrAll="left_All_1"==$(event.currentTarget).attr("id")?"option":":selected";$("#mSelectRight "+selectOrAll).map(function(e,t){"false"==$(t).attr("mandatory")&&(leftSelectedClickedOnce=!0,$("#mSelectLeft").append($("<option>",{value:$(this).val(),text:$(this).text(),mandatory:!1})),$(this).remove())})}}})}function checkIfFormChanges(){var e=$("#ddlImpTbl").val();return isFormDirty="NA"!=e}function setFailedSummaryColumnHeadings(){$("#thSummFileName").text(eval(callParent("lcm[263]"))),$("#thSummRecords").text(eval(callParent("lcm[264]"))),$("#thSummAdded").text(eval(callParent("lcm[357]"))),$("#thSummUpdated").text(eval(callParent("lcm[358]"))),$("#thSummFailed").text(eval(callParent("lcm[266]"))),$("#hdnIgnoredColumns").val(""),ignoredColumns=[]}function addChkbxsToGrdColumns(){var e=$("#gridImpData").data("column-select");$("#gridImpData > tbody > tr > th").each(function(){$(this).find("option").each(function(){var e=$(this).text().trim(),t=$(this).val();e.includes("(")||$(this).text(e+" ("+t+")"),$(this).val(t).trigger("change")})}),e==undefined&&($("#gridImpData th").each(function(){$(this).css({"min-width":"160px"}),$(this).find("select").addClass("form-select"),$(this).find("select").select2(),$(this).find("select").css("width","auto"),selectId=$(this).find("select").attr("id"),$(this).append("<label class='checkbox-inline'><br><input type='checkbox' class='grd-column-select me-2 w-20px h-20px' checked id='chk"+selectId+"'/><span>Select Column</span></label><i tabindex='0' data-trigger='focus' class='icon-arrows-question col-info' data-toggle='popover' data-content='Uncheck to ignore this column' data-placement='right' style='cursor: pointer;'  title=''></i>"),curselectVal=$(this).find("select").val(),mandatory=$("#mSelectRight option[value='"+curselectVal+"']").attr("mandatory"),mandatory=mandatory!=undefined&&JSON.parse(mandatory),mandatory&&$("#chk"+selectId).attr("disabled","disabled")}),$(".grd-column-select").change(function(){var e=$(this).is(":checked"),t=$(this).closest("th").index()+1;e?($(this).closest("th").find("select").removeAttr("disabled"),$("#gridImpData tr td:nth-child("+t+"), #gridImpData tr th:nth-child("+t+")").removeClass("column-disabled"),updateIgnoredColumns(t,"pop")):($(this).closest("th").find("select").attr("disabled","disabled"),$("#gridImpData tr td:nth-child("+t+"), #gridImpData tr th:nth-child("+t+")").addClass("column-disabled"),updateIgnoredColumns(t,"push"));var l=$(this).closest("th").find("select").is(":disabled"),a=$(this).closest("th").find("select").val();l?$("#ddlPrimaryKey option[value='"+a+"']").attr("disabled","disabled"):$("#ddlPrimaryKey option[value='"+a+"']").removeAttr("disabled")}),$("#gridImpData").attr("data-column-select",!0));try{var t;null===(t=KTApp)||void 0===t||t.initBootstrapTooltips()}catch(l){}}function disabledIgnoredColumns(e){e>0&&(--e,$("#gridImpData tr").each(function(){$(this).find("td:gt("+e+"), th:gt("+e+")").addClass("column-disabled")}),$("#gridImpData tr th:gt("+e+")").find("select").attr("disabled","disabled"),$("#gridImpData tr th").find("select[disabled]").each(function(){var e=$(this).val();$("#ddlPrimaryKey option[value='"+e+"']").attr("disabled","disabled"),updateIgnoredColumns($(this).parent().index()+1,"push")}),$("#gridImpData tr th:gt("+e+")").find(".checkbox-inline, .col-info").remove())}function filepaths(e){filepath=e}function unselectIgnoredColumns(){$("#gridImpData tr th").find("select[disabled]").each(function(){var e=$(this).val(),t=$(this).find("option[selected]").text();0==$('#mSelectLeft option[value="'+e+'"]').length&&($("#mSelectLeft").append($("<option>",{value:e,text:t,mandatory:!1})),$("#mSelectRight option[value='"+e+"']").remove())}),oldSelectedValues=$("#mSelectRight option").length}function updateIgnoredColumns(e,t){var l=ignoredColumns.indexOf(e);"push"==t?-1===l&&ignoredColumns.push(e):-1!==l&&ignoredColumns.splice(l,1),$("#hdnIgnoredColumns").val(ignoredColumns.sort(function(e,t){return e-t}))}function GetImpData(e,t,l,a,r,n,o,i){var s=!1,c=$("#upFileName").val(),d=($("#uploadFileName").val(),$("#hdnFname").val()),p=$("#select2-selectPrimaryKey-container").text(),m=((.015*parseInt($("#hdnRowCount").val())).toFixed(2),$("#xlnum").text().replace(/(sheet\d+)/g,function(e,t,l){return l>0&&","!==$("#xlnum").text()[l-1]?", ".concat(t):t}));if("true"==$("#hdnmulForm").val()&&""!=$("#hdnuniqueNamesStringSheet").val()&&(d=$("#hdnuniqueNamesStringSheet").val()),"true"==$("#hdnmulForm").val()&&""!=$("#hdnuniqueNamesStringheaders").val()&&(p=$("#hdnuniqueNamesStringheaders").val()),m=m.replaceAll(", ,",",").replaceAll(" ",""),"true"==$("#hdnUpdateMapcolumns").val()){var u=$("#hdndheetheaders").val(),f=JSON.parse(u),h=[];Object.keys(f).forEach(function(e){f[e].forEach(function(t,l){h.push("sheet".concat(e,".col").concat(l+1,"=").concat(t))})}),m="",m=(m=h.join(", ")).replaceAll(", ",",")}var v=$("#hdnxlHasHeader").val();-1!=d.indexOf("$$")&&(v="true");var g=$("#hdnsheetSequence").val();g=g.replaceAll(" ",""),ShowDimmer(!0);var y={convertxltojson:{redisserver:e,redisport:t,redispwd:l,project:a,s:"$SESSIONID$",username:"$USERNAME$",signalrurl:"$SIGNALRURL$",armscripturl:"$ARMSCRIPTURL$",transid:d,keyfield:p,importfile:c,sheetnames:g,trace:i,mapcolumns:m,hasheader:v}},b={url:"../aspx/ImportAll.aspx/PushToImportQueue",type:"POST",cache:!1,async:!1,dataType:"json",data:JSON.stringify({queueData:JSON.stringify(y),transid:d}),contentType:"application/json"};$.ajax(b).done(function(e){var t,l;""!=e.d&&"keyexist"==e.d?(s="error",ShowDimmer(!1),showAlertDialog("warning","Previous request still in process. Please wait till you get the notification")):e.d&&!e.d.startsWith("RMQError:")&&JSON.parse(e.d)&&1==(null===(t=JSON.parse(e.d))||void 0===t?void 0:null===(l=t.result)||void 0===l?void 0:l.success)?s=!0:e.d.startsWith("RMQError:")?(s="error",ShowDimmer(!1),showAlertDialog("error",e.d.replace("RMQError:",""))):e.d.startsWith("Error:")&&(s=!1)});document.getElementById("imWizardEdit");return"error"!=s.toString()&&(s?(ShowDimmer(!1),callParentNew("btn-close","class")[0].click(),showAlertDialog("success","Your Excel file has been successfully uploaded and queued for processing. The file will be processed shortly, and you will be notified upon completion.You can continue with other tasks while the import is being handled.")):(ShowDimmer(!1),callParentNew("btn-close","class")[0].click(),showAlertDialog("error","An error occurred while processing the file. Please ensure that the file is correct and the environment is properly set up. Refer to the logs for more details and try again."))),s}function SuccessCallbackRestSave(e,t){try{var l=$j.parseJSON(e)}catch(a){ShowDimmer(!1)}l!=undefined&&"success"==l.status?(callParentNew("btn-close","class")[0].click(),showAlertDialog("success","Your Excel file has been successfully uploaded and queued for processing. The file will be processed shortly, and you will be notified upon completion.You can continue with other tasks while the import is being handled.")):(callParentNew("btn-close","class")[0].click(),showAlertDialog("error","An error occurred while processing the file. Please ensure that the file is correct and the environment is properly set up. Refer to the logs for more details and try again."))}function OnExceptionRestSave(e,t){}function showPopover(){$('[data-bs-toggle="popover"]').popover({placement:placement})}function DropzoneInitImport(){var e="#dropzone_AxpFileImport",t=document.querySelector(e),l=t.querySelector(".dropzone-item");l.id="";var a=l.parentNode.innerHTML;l.parentNode.removeChild(l);var r=location.origin+location.pathname.substr(0,location.pathname.indexOf("aspx")),n=new Dropzone(e,{url:r+"FileUploadHandler.ashx",previewTemplate:a,addRemoveLinks:!0,maxFilesize:10,previewsContainer:e+" .dropzone-items",clickable:e+" .dropzone-select"});n.on("addedfile",function(e){t.querySelectorAll(".dropzone-item").forEach(function(e){e.style.display=""})}),n.on("totaluploadprogress",function(e){t.querySelectorAll(".progress-bar").forEach(function(t){t.style.width=e+"%"})}),n.on("error",function(e,t){alert("Upload failed: "+t)}),n.on("complete",function(e){if($("#selectform").length>0&&null==$("#selectform").val())ShowImportError("Please choose form before upload the file.");else{var l=e.xhr.responseText;if(l.includes("successfully")){var a=l.split("&&")[1];$("#upFileName").val(a),$("#uploadFileName").val(e.name),$("#hdnOriginalfileName").val($("#uploadFileName").val()),$("#UploadButton").click()}else alert("Upload Error: "+l);setTimeout(function(){t.querySelectorAll(".dz-complete").forEach(function(e){e.querySelector(".progress-bar").style.opacity="0",e.querySelector(".progress").style.opacity="0"})},300)}})}function saveTemplateXl(){try{impTempObj=_objectSpread(_objectSpread({},impTempObj),{},{tid:"ad_it",regex:/^[0-9a-zA-Z\_]+$/,modalHTML:'<div id="select2Container" style="margin-top:20px;">\n                                    <div class="form-group col-md-12 mb-4">\n    <label class="form-label col-form-label pb-1 fw-boldest" for="selectFormTemp">Select Form</label>\n    <select id="selectForm" class="form-control">\n    </select>\n</div>\n                <div class="form-group col-md-12 mb-4">\n                    <label class="form-label col-form-label pb-1 fw-boldest" for="selectDc">Select DC</label>\n                    <select id="selectDc" class="form-control">\n                    </select>\n                </div>\n                <div class="form-group col-md-12 mb-4">\n                    <label class="form-label col-form-label pb-1 fw-boldest" for="selectFields">Select Fields</label>\n                     <div class="overflow-auto" style="max-height: 90px;">\n                    <select id="selectFields" class="form-control"  multiple="multiple">\n                    </select>\n\t\t\t\t\t</div>\n                </div>\n                                <div class="form-group col-md-12 mb-4">\n                    <label class="form-label col-form-label pb-1 fw-boldest" for="selectPrimaryKey">Select Primary Key</label>\n                    <select id="selectPrimaryKey" class="form-control" >\n                    </select>\n                </div>\n            </div>'});var e=new BSModal("ImportTemplate","Import Template",impTempObj.modalHTML,function(t){setTimeout(function(){var e=document.querySelector("#ImportTemplate .modal-dialog");e&&(e.classList.remove("modal-dialog-centered"),e.style.marginTop="10px")},100);var l=$("#hdnformQueue").val().split(","),a=$("#hdnformQueueVal").val().split(","),r=l.map(function(e,t){return{id:a[t],text:e}});$("#selectForm").select2({placeholder:"Select Form",allowClear:!0,data:r,minimumResultsForSearch:0,dropdownParent:$("#select2Container")});var n=$("#selectForm");$("#selectDc").select2({placeholder:"Select DC",multiple:!0,allowClear:!0}),$("#selectFields").select2({placeholder:"Select Fields",allowClear:!0}),$("#selectPrimaryKey").select2({placeholder:"Select Primary Key",allowClear:!0}),n.on("select2:select",function(e){var t=this;setTimeout(function(){},0);var l=$(this).val(),a=$(this)[0].id;$(this).select2("close"),$.ajax({url:"ImportAll.aspx/GetDcs",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:l}),dataType:"json",contentType:"application/json",success:function(e){parseInt(e.d).toString();for(var r=[],n=1;n<=e.d;n++)r.push("DC"+n);a="#selectDc",$(a).empty(),r.forEach(function(e){$(a).append($("<option>").text(e))});var o=new Option("Select All","selectAll",!1,!1);$("#selectDc").prepend(o),$("#selectDc").trigger("change"),$("#selectDc").on("select2:select",function(e){"selectAll"===e.params.data.id&&($("#selectDc > option").each(function(){"selectAll"!==$(this).val()&&$(this).prop("selected",!0)}),$("#selectDc").trigger("change")),$(".select2-selection__rendered").find("li.select2-selection__choice").each(function(){"Select All"==$(this).attr("title")&&$(this).remove()}),BindSelectDcFields(l)}),$("#selectDc").on("select2:unselect",function(e){"selectAll"===e.params.data.id&&($("#selectDc > option").prop("selected",!1),$("#selectDc").trigger("change")),$(".select2-selection__rendered").find("li.select2-selection__choice").each(function(){"Select All"==$(this).attr("title")&&$(this).remove()}),BindSelectDcFields(l)}),$(t).select2("close")},error:function(e,t,l){console.error("AJAX error:",l),$(this).select2("close")}}),$.ajax({url:"ImportAll.aspx/GetFields",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:l}),dataType:"json",contentType:"application/json",success:function(e){var l=JSON.parse(e.d),a=l.VisibleTstFlds.m_StringValue,r=l.visibleTstFldsGridDc.m_StringValue.slice(0,-1).split(","),n={};r.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];n[a]||(n[a]=[]),n[a].push(l)});var o=Object.entries(n).map(function(e){var t=_slicedToArray(e,2),l=t[0],a=t[1];return{dc:parseInt(l),fields:a}}),i=l.visibleTstFldsNonGriddc.m_StringValue.slice(0,-1).split(","),s={};i.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];s[a]||(s[a]=[]),s[a].push(l)});var c=Object.entries(s).map(function(e){var t=_slicedToArray(e,2),l=t[0],a=t[1];return{dc:parseInt(l),fields:a}}),d=[].concat(_toConsumableArray(c),_toConsumableArray(o)).sort(function(e,t){return e.dc-t.dc});arraysByDC=d.map(function(e){return e.fields});var p=a.indexOf(",♠"),m="";-1!==p&&(m=a.substring(0,p),a.substring(p+",♠".length));var u=m.split(",");$(t).select2("close");$("#selectFields").empty();var f=$("#selectPrimaryKey");$(f).empty(),u.forEach(function(e){$("#selectFields").append($("<option></option>").attr("value",e).text(e))});var h=new Option("Select All","selectAll",!1,!1);$("#selectFields").prepend(h),$("#selectFields").trigger("change"),$("#selectFields").on("select2:select",function(e){"selectAll"===e.params.data.id&&($("#selectFields > option").each(function(){"selectAll"!==$(this).val()&&$(this).prop("selected",!0)}),$("#selectFields").trigger("change")),$(".select2-selection__rendered").find("li.select2-selection__choice").each(function(){"Select All"==$(this).attr("title")&&$(this).remove()})}),$("#selectFields").on("select2:unselect",function(e){"selectAll"===e.params.data.id&&($("#selectFields > option").prop("selected",!1),$("#selectFields").trigger("change"))}),u.forEach(function(e){$(f).append($("<option></option>").attr("value",e).text(e))}),f.hasClass("select2-hidden-accessible")&&f.select2("destroy"),f.select2({width:"100%",placeholder:"Select Primary Key",allowClear:!0,dropdownParent:$("#ImportTemplate").length?$("#ImportTemplate"):$(document.body),minimumResultsForSearch:0})},error:function(e,t,l){console.error("AJAX error:",l),$(this).select2("close")}})}),e.changeSize("lg"),e.verticallyCentered(),e.hideHeader(),e.showFloatingClose(),e.cancelBtn.classList.add("btn-sm"),e.okBtn.classList.add("btn-sm"),e.okBtn.addEventListener("click",function(e){for(var t=$("#select2-selectForm-container").text()+"("+$("#selectForm").val()+").xlsx",l=0;l<arraysByDC.length;l++)arraysByDC[l]=arraysByDC[l].filter(function(e){return $("#selectFields").val().includes(e)});arraysByDC=arraysByDC.filter(function(e){return e.length>0&&e.some(function(e){return""!==e.trim()})});for(var a=0;a<arraysByDC.length;a++)arraysByDC[a].includes($("#selectPrimaryKey").val())||arraysByDC[a].unshift($("#selectPrimaryKey").val());$.ajax({type:"POST",url:"ImportAll.aspx/GenerateExcel",data:JSON.stringify({transid:$("#selectForm").val(),arraysByDC:arraysByDC}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var l=document.createElement("a");l.href="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,"+e.d,l.download=t,l.click()},error:function(e,t,l){console.error("Error: "+l)}})})})}catch(t){return}}function BindSelectDcFields(e){var t=($("#selectDc").val()||[]).filter(function(e){return"selectall"!==e.toLowerCase()}).map(function(e){return e.replace(/^DC/i,"").trim()}).join(",");$.ajax({url:"ImportAll.aspx/GetFieldsNew",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:e,_selectedDcs:t}),dataType:"json",contentType:"application/json",success:function(e){var t=JSON.parse(e.d),l=t.VisibleTstFlds.m_StringValue,a=t.visibleTstFldsGridDc.m_StringValue.slice(0,-1).split(","),r={};a.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];r[a]||(r[a]=[]),r[a].push(l)});var n=Object.entries(r).map(function(e){var t=_slicedToArray(e,2),l=t[0],a=t[1];return{dc:parseInt(l),fields:a}}),o=t.visibleTstFldsNonGriddc.m_StringValue.slice(0,-1).split(","),i={};o.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];i[a]||(i[a]=[]),i[a].push(l)});var s=Object.entries(i).map(function(e){var t=_slicedToArray(e,2),l=t[0],a=t[1];return{dc:parseInt(l),fields:a}}),c=[].concat(_toConsumableArray(s),_toConsumableArray(n)).sort(function(e,t){return e.dc-t.dc});arraysByDC=c.map(function(e){return e.fields});var d=l.indexOf(",♠"),p="";-1!==d&&(p=l.substring(0,d),l.substring(d+",♠".length));var m=p.split(",");$("#selectFields").empty();var u=$("#selectPrimaryKey");u.empty(),m.forEach(function(e){$("#selectFields").append($("<option></option>").attr("value",e).text(e))});var f=new Option("Select All","selectAll",!1,!1);$("#selectFields").prepend(f),$("#selectFields").trigger("change"),$("#selectFields").on("select2:select",function(e){"selectAll"===e.params.data.id&&($("#selectFields > option").each(function(){"selectAll"!==$(this).val()&&$(this).prop("selected",!0)}),$("#selectFields").trigger("change")),$(".select2-selection__rendered").find("li.select2-selection__choice").each(function(){"Select All"==$(this).attr("title")&&$(this).remove()})}),$("#selectFields").on("select2:unselect",function(e){"selectAll"===e.params.data.id&&($("#selectFields > option").prop("selected",!1),$("#selectFields").trigger("change"))}),m.forEach(function(e){$(u).append($("<option></option>").attr("value",e).text(e))}),u.hasClass("select2-hidden-accessible")&&u.select2("destroy"),u.select2({width:"100%",placeholder:"Select Primary Key",allowClear:!0,dropdownParent:$("#ImportTemplate").length?$("#ImportTemplate"):$(document.body),minimumResultsForSearch:0})},error:function(e,t,l){console.error("AJAX error:",l),$(this).select2("close")}})}function saveTemplate(){try{if(1!=validateDataSearchWiz())return showAlertDialog("warning",appGlobalVarsObject.lcm[108]),void $("#mSelectLeft").trigger("focus");impTempObj=_objectSpread(_objectSpread({},impTempObj),{},{tid:"ad_it",regex:/^[0-9a-zA-Z\_]+$/,modalHTML:'<div class="mb-3">\n                    <label for="impTemplateName" class="form-label col-form-label required">Template Name</label>\n                    <input type="text" class="form-control" id="impTemplateName" placeholder="Template Name">\n                </div>\n                <div class="mb-3">\n                    <label for="impTemplateCaption" class="form-label col-form-label required">Template Caption</label>\n                    <input type="text" class="form-control" id="impTemplateCaption" placeholder="Template Caption">\n                </div>'});var e=new BSModal("ImportTemplate","Import Template",impTempObj.modalHTML,function(e){if(""!=$("#ddlImpTemplate").val()&&"NA"!=$("#ddlImpTemplate").val()){var t=$("#ddlImpTemplate").select2("data")[0].text,l=$("#ddlImpTemplate").select2("data")[0].id;$("#impTemplateCaption").val(t).trigger("focus"),$("#impTemplateName").val(l).prop("disabled",!0)}else $("#impTemplateName").trigger("focus")},function(e){});e.changeSize("sm"),e.verticallyCentered(),e.hideHeader(),e.showFloatingClose(),e.cancelBtn.classList.add("btn-sm"),e.okBtn.classList.add("btn-sm"),e.okBtn.addEventListener("click",function(e){try{impTempObj.flds={cols:["stransid","templatename","templatecap","impfields","recordid","dataupd","fldpkey"],vals:[]},impTempObj.flds.vals.push($("#hdnTransid").val()||""),impTempObj.flds.vals.push($("#impTemplateName").val()||""),impTempObj.flds.vals.push($("#impTemplateCaption").val()||"");var t=$("#hdnColNames").val()||"";if(""!=t&&(t=t.replace(/^\s+|\s+$/gm,"").replaceAll("\n","").replace(/,\s+/g,",")),impTempObj.flds.vals.push(t||""),""==impTempObj.flds.vals[1]&&showAlertDialog("warning","Template Name cannot be empty!"),""==impTempObj.flds.vals[2]&&showAlertDialog("warning","Template Caption cannot be empty!"),$("#dataupdatecheck").is(":checked")?(impTempObj.flds.vals[5]="T",impTempObj.flds.vals[6]=$("#tstFlds").val()):(impTempObj.flds.vals[5]="F",impTempObj.flds.vals[6]=""),""!=impTempObj.flds.vals[1]&&""!=impTempObj.flds.vals[2])if(impTempObj.regex.test(impTempObj.flds.vals[1])){var l,a;$.each(impTempObj.flds.cols,function(e,t){"recordid"!=t&&AxSetValue(impTempObj.tid,t,1,0,impTempObj.flds.vals[e])});var r=("undefined"!=typeof impTempObj.selected?null===(l=impTempObj)||void 0===l?void 0:null===(a=l.selected[0])||void 0===a?void 0:a.axpdef_impdata_templatesid:"0")||"0",n=AxSubmitData(impTempObj.tid,r);if(impTempObj.flds.vals.push(AssignLoadValues(n)),""!=impTempObj.flds.vals[4]){var o=$("#ddlImpTemplate option:not(:first)");0!=o.length&&($.each(o,function(e,t){t.value==impTempObj.flds.vals[1]&&$("#ddlImpTemplate option[value='".concat(t.value,"']")).remove()}),impTempObj.sqlRes=impTempObj.sqlRes.filter(function(e){return e.templatename!==impTempObj.flds.vals[1]})),impTempObj.selected=[{axpdef_impdata_templatesid:impTempObj.flds.vals[4],templatename:impTempObj.flds.vals[1],templatecap:impTempObj.flds.vals[2],impfields:impTempObj.flds.vals[3]}],impTempObj.sqlRes.push({axpdef_impdata_templatesid:impTempObj.flds.vals[4],templatename:impTempObj.flds.vals[1],templatecap:impTempObj.flds.vals[2],impfields:impTempObj.flds.vals[3]}),$("#ddlImpTemplate").append(new Option(impTempObj.flds.vals[2],impTempObj.flds.vals[1],!0,!0)).trigger("change"),$("#btnContinue").trigger("click")}}else showAlertDialog("error","Invalid Template Name!")}catch(i){showAlertDialog("error",i.message)}})}catch(t){return showAlertDialog("warning",appGlobalVarsObject.lcm[108]),void $("#mSelectLeft").trigger("focus")}}function importHistory(){ShowDimmer(!0);var e={modalHTML:'<iframe id="impHistoryFrame" src="../aspx/ivtoivload.aspx?ivname=ad_implg&ptransid='.concat($("#hdnTransid").val(),'" scrolling="no" class="w-100 h-100 h-md-400px"></iframe>')},t=new BSModal("ImportHistory","Import History",e.modalHTML,function(e){try{var t=0,l=setInterval(function(){var e,a,r,n;10==++t&&(clearInterval(l),ShowDimmer(!1));var o=null===(e=document.getElementById("impHistoryFrame"))||void 0===e?void 0:null===(a=e.contentWindow)||void 0===a?void 0:null===(r=a.document)||void 0===r?void 0:null===(n=r.getElementsByClassName("iframeScrollFix")[0])||void 0===n?void 0:n.getElementsByTagName("body");void 0!==o&&o.length>0&&(clearInterval(l),ShowDimmer(!1))},1e3)}catch(a){clearInterval(l),ShowDimmer(!1)}},function(e){});t.changeSize("xl"),t.hideHeader(),t.hideFooter(),t.showFloatingClose(),t.okBtn.classList.add("btn-sm"),t.cancelBtn.classList.add("btn-sm")}function AssignLoadValues(e){for(var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"",l="",a=e.split("*$*"),r=0;r<a.length;r++){var n=a[r].toString().replace(new RegExp("\\n","g"),"");try{var o=$j.parseJSON(n)}catch(i){continue}o.error?ExecErrorMsg(o.error,t):o.message&&(l=ExecMessage(o.message,t))}return l}function ExecMessage(e){for(var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"",l="",a="0",r=0;r<e.length;r++){var n=e[r].msg;if(n.indexOf("recordid")>-1){var o=n.split(",");n="";for(var i=0;i<o.length;i++)-1==o[i].indexOf("recordid=")?i==o.length-1?n+=o[i]:n+=o[i]+",":-1!=o[i].indexOf("recordid=")&&(a=o[i].split("=")[1])}n.indexOf("errfld")>-1&&(n=n.substring(0,n.lastIndexOf("errfld")-2));for(var s=(n=n.split(",")).length,c="",d=0;d<s;d++){var p=(c+=n[d]+",").indexOf("["),m=c.indexOf("]");if(""!=c.substring(p+1,m)){var u=c.substring(p,m+2);c=c.replace(u,""),l="error"}for(var f=c.indexOf("^^dq");-1!=f;)f=(c=c.replace("^^dq",'"')).indexOf("^^dq")}if(""!=c){if("Action"==t&&c.indexOf("recordid")>0&&(c=c.substr(0,c.indexOf("recordid"))),"Action"!=t&&"Iview"!=t||-1==c.indexOf("`"))l=-1!=c.toLowerCase().indexOf("invalid")||-1!=c.indexOf("cannot be left empty")?"error":-1!=c.toLowerCase().indexOf("is completed")||-1!=c.toLowerCase().indexOf("saved successfully")?"success":"info";else{var h=c.split("`")[0].toLowerCase();h.indexOf(",")>-1&&(h=h.split(",")[1]),"simple"==h||""==h?l="info":"warning"==h?l="warning":"confirmation"==h?l="success":"exceptions"==h&&(l="error"),c=c.split("`")[1].slice(0,-1)}-1!=c.indexOf("cannot be left empty")&&(c=c.replace("cannot be left empty",appGlobalVarsObject.lcm[45])),showAlertDialog(l,c)}}return a}function ExecErrorMsg(e){arguments.length>1&&arguments[1]!==undefined&&arguments[1];for(var t=0;t<e.length;t++){var l=e[t].msg;e[t].errfld&&e[t].errfld;for(var a=l.indexOf("^^dq");-1!=a;)a=(l=l.replace("^^dq",'"')).indexOf("^^dq");null!=l&&l!=undefined&&""!=l&&(l.indexOf("errfld")>-1&&(l=(l=l.substring(0,l.lastIndexOf("errfld")-2)).replace('",',"").replace('" ,',"")),showAlertDialog("error",l))}}function deleteTemplate(){try{var e=$("#ddlImpTemplate").val();if(null!=e&&""!=e&&"NA"!=e)var t="ar"==callParentNew("gllangType"),l=$.confirm({theme:"modern",title:appGlobalVarsObject.lcm[155],onContentReady:function(){disableBackDrop("bind")},backgroundDismiss:"false",escapeKey:"buttonB",rtl:t,content:"Do you want to delete ".concat($("#ddlImpTemplate").select2("data")[0].text," Template?"),buttons:{buttonA:{text:appGlobalVarsObject.lcm[164],btnClass:"btn btn-primary",action:function(){delConfirmCB(e),l.close(),disableBackDrop("destroy")}},buttonB:{text:appGlobalVarsObject.lcm[192],btnClass:"btn btn-bg-light btn-color-danger btn-active-light-danger",action:function(){l.close(),disableBackDrop("destroy")}}}});else showAlertDialog("warning","Please select a template to delete")}catch(a){showAlertDialog("error",a.message)}}function delConfirmCB(e){try{$.ajax({url:"Importnew.aspx/deleteTemplate",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:$("#hdnTransid").val(),tempname:e}),dataType:"json",contentType:"application/json",success:function(t){"done"==t.d?(impTempObj.sqlRes=impTempObj.sqlRes.filter(function(t){return t.templatename!==e}),$("#ddlImpTemplate option[value='".concat(e,"']")).remove(),$("#ddlImpTemplate").val("NA").trigger("select2:select"),showAlertDialog("success","Template deleted successfully")):showAlertDialog("error","Error occurred while deleting the template")},error:function(e){showAlertDialog("error","Error occurred while deleting the template")}})}catch(t){showAlertDialog("error",t.message)}}function impFldsReOrder(){try{var e={preOrdOpts:$("#mSelectRight option")};if(e.preOrdOpts.length>1){e.isOrdered=!1,e.li="",$.each(e.preOrdOpts,function(t,l){e.li+='<li class="d-flex list-group-item ui-state-default ui-sortable-handle" data-optval="'.concat(l.attributes.value.value,'" data-optmand="').concat(l.attributes.mandatory.value,'" data-opttext="').concat(l.text,'">\n                    <span class="material-icons dragIcon cursor-drag my-auto">drag_indicator</span>                \n                    <label class="form-label fw-boldest my-2">\n                        <span class="dragName">').concat(l.text,"</span>\n                    </label>\n                </li> ")}),e.Html='<div class="impFldsReOrdWrapper h-450px min-h-sm-100px">\n                <ul class="card list-group ui-sortable">\n                    '.concat(e.li,"\n                </ul>\n            </div>");var t=new BSModal("ImportReOrder","Import Re-Order",e.Html,function(t){$(".impFldsReOrdWrapper > .list-group").sortable({cursor:"move",update:function(t,l){e.isOrdered=!0}})},function(e){});t.hideHeader(),t.scrollableDialog(),t.modalFooter.classList.add("py-2"),t.cancelBtn.classList.add("btn-sm"),t.okBtn.classList.add("btn-sm"),t.okBtn.innerText="Re-Order",t.okBtn.removeAttribute("data-bs-dismiss"),t.okBtn.addEventListener("click",function(t){try{e.isOrdered?(e.postOrdOpts=$(".impFldsReOrdWrapper > .list-group > .list-group-item").map(function(e,t){return{ordno:e+1,liOpt:{val:$(t).data("optval"),mandatory:$(t).data("optmand"),text:$(t).data("opttext")}}}).toArray(),$("#mSelectRight option").remove(),$.each(e.postOrdOpts,function(e,t){$("#mSelectRight").append($("<option>",{value:t.liOpt.val,text:t.liOpt.text,mandatory:t.liOpt.mandatory}))}),showAlertDialog("success","Reorder successful"),callParentNew("ImportReOrder","id").dispatchEvent(new CustomEvent("close"))):showAlertDialog("warning","Please reorder the fields")}catch(l){showAlertDialog("error",l.message)}})}else 1==e.preOrdOpts.length?showAlertDialog("warning","Not enough options to reorder."):showAlertDialog("warning","No options to reorder.")}catch(l){showAlertDialog("error",l.message)}}function GetTemplates(){try{impTempObj.sqlRes=[],$.ajax({url:"Importnew.aspx/GetTemplates",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:$("#hdnTransid").val()}),dataType:"json",contentType:"application/json",success:function(e){e&&""!=e.d?(e=JSON.parse(e.d)).result&&e.result.row&&(e.result.row.forEach(function(e){var t={};$.map(e,function(e,l){t[l.toLowerCase()]=e}),impTempObj.sqlRes.push(t)}),e.result.row.length>0?impTempObj.ddList=Array.from(new Set([{id:"NA",text:appGlobalVarsObject.lcm[441]}].concat(_toConsumableArray($.map(impTempObj.sqlRes,function(e,t){return{id:e.templatename,text:e.templatecap}}))))):impTempObj.ddList=[{id:"NA",text:appGlobalVarsObject.lcm[441]}]):(impTempObj.ddList=[{id:"NA",text:appGlobalVarsObject.lcm[441]}],showAlertDialog("error",3028,"client"))},error:function(e){impTempObj.ddList=[{id:"NA",text:appGlobalVarsObject.lcm[441]}],showAlertDialog("error",3028,"client")}})}catch(e){impTempObj.ddList=[{id:"NA",text:appGlobalVarsObject.lcm[441]}],showAlertDialog("error",e.message)}}Dropzone.autoDiscover=!1,window.addEventListener("error",function(e){var t=e.error;console.log(t)}),$(document).ready(function(){addSheetRow1(),$("#selectform").select2(),$("#selectPrimaryKey").select2(),$("#mulForm").on("change",function(){$(this).is(":checked")?($("#selectform, #selectPrimaryKey").prop("disabled",!0),$("#hdnmulForm").val("true"),$("#xlnum").addClass("d-none")):($("#selectform, #selectPrimaryKey").prop("disabled",!1),$("#hdnmulForm").val("false"),$("#xlnum").removeClass("d-none"),""!=$("#hdnaxmsgid").val()&&($("#selectform").attr("disabled",!0),$("#selectPrimaryKey").attr("disabled",!0)))}),$("#selectform").select2(),$("#selectPrimaryKey").select2(),""!=$("#hdnaxmsgid").val()&&(ShowDimmer(!0),$.ajax({url:"ImportAll.aspx/GETtabledata",type:"POST",cache:!1,async:!1,data:JSON.stringify({tempname:$("#hdnaxmsgid").val()}),dataType:"json",contentType:"application/json",success:function(e){var t=e.d.replace(/[\r\n]+/g,"\\n"),l=JSON.parse(t),a=l.rapidsave.transid;$("#hdnFname").val(l.rapidsave.transid),a.includes("(")&&(a=a.split("(")[1].split(")")[0]);var r=l.rapidsave.keyfield;$("#hdnFnameKey").val(l.rapidsave.keyfield),r=r.split("(")[1].split(")")[0];var n=l.rapidsave.impfilewithsummary;fileUrl=n,$("#hdnExcelfilepath").val(fileUrl);var o=fileUrl.substring(fileUrl.lastIndexOf("\\")+1);o=decodeURIComponent(o),$("#hdnExcelfileName").val(o);var i=l.rapidsave.mapcolumns;$("#selectform").val(a).trigger("change"),$("#selectform").attr("disabled",!0),$.ajax({url:"ImportAll.aspx/GetFields",type:"POST",cache:!1,async:!1,data:JSON.stringify({transid:a}),dataType:"json",contentType:"application/json",success:function(e){var t=JSON.parse(e.d),l=t.VisibleTstFlds.m_StringValue,a=t.visibleTstFldsGridDc.m_StringValue.slice(0,-1).split(","),n={};a.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];n[a]||(n[a]=[]),n[a].push(l)});var o=Object.entries(n).map(function(e){var t=_slicedToArray(e,2);t[0];return{fields:t[1]}}),s=t.visibleTstFldsNonGriddc.m_StringValue.slice(0,-1).split(","),c={};s.forEach(function(e){var t=_slicedToArray(e.split("♠"),2),l=t[0],a=t[1];c[a]||(c[a]=[]),c[a].push(l)});var d=Object.entries(c).map(function(e){var t=_slicedToArray(e,2);t[0];return{fields:t[1]}}),p=[].concat(_toConsumableArray(d),_toConsumableArray(o));p.sort(function(e,t){return parseInt(e.dc)-parseInt(t.dc)}),(arraysByDC=p.map(function(e){return e.fields})).forEach(function(e,t){console.log("Array for DC ".concat(p[t].dc,":"),e)});var m=l.indexOf(",♠"),u="";-1!==m&&(u=l.substring(0,m),l.substring(m+",♠".length)),$("#hdnFieldnamesExcelnew").val(u);var f=u.split(",");$("#selectPrimaryKey").empty();var h=f.map(function(e){var t=e.match(/\((.*?)\)/);return t?t[1]:""});f.forEach(function(e,t){$("#selectPrimaryKey").append($("<option></option>").attr("value",h[t]).text(e))}),$("#selectPrimaryKey").val(r).trigger("change"),$("#selectPrimaryKey").attr("disabled",!0),$("#btnSaveTemplateXl").addClass("d-none"),$("#xlnum").addClass("form-control"),$("#xlnum").text(i),$("#btnDownloadxl").insertBefore("#selectform"),$("#btnDownloadxl").removeClass("d-none"),ShowDimmer(!1)}})}})),$("#btnDownloadxl").click(function(){var e=fileUrl;$.ajax({url:"ImportAll.aspx/DownloadExcelFile",type:"POST",cache:!1,async:!1,data:JSON.stringify({filepathxl:e}),dataType:"json",contentType:"application/json",success:function(e){}})});var tstFldsArr=$("#hdnTstructflds").val().slice(0,-1).split(","),collapseButton=$("<button>").addClass("btn btn-primary mb-4").attr("type","button").attr("data-toggle","collapse").attr("data-target",".sheetCollapse").text("Show/Hide Additional Sheets");function createSelect(e,t){var l=$("<select>").addClass("select2 form-select forValidation selectpicker mb-4");return l.append($("<option>").text(e).attr("disabled",!0).attr("selected",!0)),t.forEach(function(e){l.append($("<option>").text(e))}),l}$("#dropdownsContainer").prepend(collapseButton),$(document).on("shown.bs.collapse",function(){$(".sheetselect").select2()}),$("#DropDownList1").select2(),$("#DropDownList2").select2({allowClear:!1}).on("select2:select",function(){var e=$(this).val();$.ajax({url:"ImportAll.aspx/GETdata",type:"POST",cache:!1,async:!1,data:JSON.stringify({tempname:e}),dataType:"json",contentType:"application/json",success:function(e){}})}),$("#DropDownList1").addClass("d-none"),$("#DropDownList1").removeClass("select2-hidden-accessible"),$("#tstFlds").select2({allowClear:!1,data:[{id:"",text:"--Select--"}].concat(_toConsumableArray(tstFldsArr))}).on("select2:select",function(e){try{var t,l,a=null===(t=$(e.currentTarget).data("select2"))||void 0===t?void 0:null===(l=t.$element[0])||void 0===l?void 0:l.id,r=$("#".concat(a)).val(),n={fields:[]},o={field:[]};if(""!=r&&-1==r.indexOf("--Select--")){var i=r.split("(")[1].replace(")","").trim();o.field.push({val:i,text:r}),$("#mSelectLeft  option").remove(),$("#mSelectRight  option").remove(),$.each(o.field,function(e,t){$("#mSelectRight").append($("<option>",{value:t.val,text:t.text}))})}else $("#mSelectLeft  option").remove(),$("#mSelectRight  option").remove();tstFldsArr.forEach(function(e){var t=e.split("("),l=(t[0].trim(),t[1].replace(")","").trim());n.fields.push({val:l,text:e})});var s={fields:n.fields.filter(function(e){return!(e.text===o.field[0].text&&e.val===o.field[0].val)})};$.each(s.fields,function(e,t){$("#mSelectLeft").append($("<option>",{value:t.val,text:t.text}))}),updateMandatoryFieldsInTemplate()}catch(c){}}),$("#dataupdatecheck").change(function(){if($(this).is(":checked")){$("#dataupdate").removeClass("d-none"),$("#mSelectLeft  option").remove(),$("#mSelectRight  option").remove();var e={fields:[]},t={field:[]};if(""!=$("#tstFlds").val()&&-1==$("#tstFlds").val().indexOf("--Select--")){var l=$("#tstFlds").val().split("(")[1].replace(")","").trim();t.field.push({val:l,text:$("#tstFlds").val()}),tstFldsArr.forEach(function(t){var l=t.split("("),a=(l[0].trim(),l[1].replace(")","").trim());e.fields.push({val:a,text:t})});var a={fields:e.fields.filter(function(e){return!(e.text===t.field[0].text&&e.val===t.field[0].val)})};$.each(a.fields,function(e,t){$("#mSelectLeft").append($("<option>",{value:t.val,text:t.text}))}),$.each(t.field,function(e,t){$("#mSelectRight").append($("<option>",{value:t.val,text:t.text}))})}updateMandatoryFieldsInTemplate()}else{if($("#mSelectLeft  option").remove(),$("#mSelectRight  option").remove(),""!=$("#hdnMandatoryFields").val()){var r=$("#hdnMandatoryFields").val().split("\n").filter(function(e){return""!==e.trim()}).map(function(e){var t=e.indexOf("("),l=e.lastIndexOf(")");return-1!==t&&-1!==l&&l>t?e.substring(0,t)+e.substring(t,l+1):""}).join(",").split(",").map(function(e){return e.trim()}).join(",").split(",").filter(function(e){return""!==e.trim()}).map(function(e){return e.trim()}),n=$("#hdnLeftFlds").val().split(",").filter(function(e){return!r.includes(e)});t={field:[]},e={field:[]};n.forEach(function(t){var l=t.split("("),a=(l[0].trim(),l[1].replace(")","").trim());e.field.push({val:a,text:t})}),$.each(e.field,function(e,t){$("#mSelectLeft").append($("<option>",{value:t.val,text:t.text}))}),r.forEach(function(e){var l=e.split("("),a=(l[0].trim(),l[1].replace(")","").trim());t.field.push({val:a,text:e})}),$.each(t.field,function(e,t){$("#mSelectRight").append($("<option>",{value:t.val,text:t.text}))}),updateMandatoryFieldsInTemplate()}else{var o={field:[]};$("#hdnLeftFlds").val().split(",").forEach(function(e){var t=e.split("("),l=(t[0].trim(),t[1].replace(")","").trim());o.field.push({val:l,text:e})}),$.each(o.field,function(e,t){$("#mSelectLeft").append($("<option>",{value:t.val,text:t.text}))}),updateMandatoryFieldsInTemplate()}$("#dataupdate").addClass("d-none")}});var element=document.querySelector("#kt_stepper_example_clickable"),stepper=new KTStepper(element);stepper.on("kt.stepper.click",function(e){e.stepped&&e.goTo(e.getClickedStepIndex())}),stepper.on("kt.stepper.next",function(e){return 1==e.getCurrentStepIndex()?""!=$("#uploadFileName").val()?($("#hdnSheetnumber").val($("#selectsheet option").length.toString()),void $("#btnImport").click()):void showAlertDialog("warning",appGlobalVarsObject.lcm[113]):2==e.getCurrentStepIndex()?($("#hdnsltForm").val($("#selectform").val()),$("#hdnsltDC").val($("#selectDC").val().toString().toLowerCase()),$("#hdnsltTemp").val($("#projectName").val()),$("#hdnsltFormFull").val($("#select2-selectform-container").text()),$("#hdnsltPkey").val($("#selectPrimaryKey").val()),void e.goNext()):void 0}),stepper.on("kt.stepper.previous",function(e){e.goPrevious(),1==e.getCurrentStepIndex()&&$("#btnSaveTemplate").removeClass("d-none")}),$("#ddlImpTbl, #ddlSeparator, #ddlPrimaryKey").select2(),1!=$("#ddlGroupBy").prop("disabled")&&$("#ddlGroupBy").select2();try{""!=$("#hdnTransid").val()&&GetTemplates(),$("#ddlImpTemplate").select2({allowClear:!1,data:impTempObj.ddList,placeholder:appGlobalVarsObject.lcm[441]}).on("select2:select",function(e){try{var t,l,a=null===(t=$(e.currentTarget).data("select2"))||void 0===t?void 0:null===(l=t.$element[0])||void 0===l?void 0:l.id,r=$("#".concat(a)).val()||e.params.data.id;if(void 0!==r&&""!=r&&"NA"!=r){impTempObj.selected=impTempObj.sqlRes.filter(function(e){if(e.templatename==r)return e}),$("#mSelectLeft, #mSelectRight").empty();var n=$("#hdnLeftFlds").val().split(","),o=impTempObj.selected[0].impfields.split(","),i=n.filter(function(e){return!o.includes(e)});if(i.length>0&&i.forEach(function(e,t){var l=e.substring(e.indexOf("(")+1,e.length-1);$("#mSelectLeft").append('<option value="'.concat(l,'">').concat(e,"</option>"))}),o.length>0&&o.forEach(function(e,t){var l=e.substring(e.indexOf("(")+1,e.length-1);$("#mSelectRight").append('<option value="'.concat(l,'">').concat(e,"</option>"))}),""!=impTempObj.selected[0].dataupd&&"T"==impTempObj.selected[0].dataupd){$("#dataupdatecheck").prop("checked",!0),$("#dataupdate").removeClass("d-none"),$("#tstFlds").select2({allowClear:!1,data:[{id:"",text:"--Select--"}].concat(_toConsumableArray(tstFldsArr))});var s=impTempObj.selected[0].fldpkey;$("#tstFlds").val(s).trigger("change")}else $("#dataupdatecheck").prop("checked",!1),$("#dataupdate").addClass("d-none");updateMandatoryFieldsInTemplate()}else{impTempObj.selected=[],$("#mSelectLeft, #mSelectRight").empty(),$("#dataupdatecheck").prop("checked",!1),$("#dataupdate").addClass("d-none"),$("#hdnLeftFlds").val().split(",").forEach(function(e,t){$("#mSelectLeft").append('<option value="'.concat(e,'">').concat(e,"</option>"))}),updateMandatoryFieldsToSelection()}}catch(c){impTempObj.selected=[],$("#mSelectLeft, #mSelectRight").empty(),$("#dataupdatecheck").prop("checked",!1),$("#dataupdate").addClass("d-none"),showAlertDialog("error",c.message)}})}catch(error){showAlertDialog("error",error.message)}DropzoneInitImport(),$("#ChkColNameInfile").attr("checked",!1),$("#icocl1").attr("data-bs-content",eval(callParent("lcm[179]"))),$("#icocl2").attr("data-bs-content",eval(callParent("lcm[181]"))),$("#icocl3").attr("data-bs-content",eval(callParent("lcm[176]"))),$("#icocl4").attr("data-bs-content",eval(callParent("lcm[177]"))),$("#icocl5").attr("data-bs-content",eval(callParent("lcm[307]"))),$("#icocl6").attr("data-bs-content",eval(callParent("lcm[308]"))),$("#icocl7").attr("data-bs-content",eval(callParent("lcm[309]"))),placement="ar"===parent.gllangType?"left":"right",$("#lblimgroupby,#lblseparator, #icocl6, #icocl7").css("float","ar"===parent.gllangType?"right":"left"),showPopover(),$("#right_All_1").prop("title",eval(callParent("lcm[171]"))).addClass("ar"===parent.gllangType?"fa-angle-double-left":"fa-angle-double-right"),$("#right_Selected_1").prop("title",eval(callParent("lcm[172]"))).addClass("ar"===parent.gllangType?"fa-angle-left":"fa-angle-right"),$("#left_Selected_1").prop("title",eval(callParent("lcm[173]"))).addClass("ar"===parent.gllangType?"fa-angle-right":"fa-angle-left"),$("#left_All_1").prop("title",eval(callParent("lcm[174]"))).addClass("ar"===parent.gllangType?"fa-angle-double-right":"fa-angle-double-left"),$("#btnFileUpload").attr({value:eval(callParent("lcm[167]")),title:eval(callParent("lcm[167]"))}),callParentNew("closeFrame()","function"),uploadFileChangeEvent(),uploadFileClickEvent(),$(document).on("keydown","input[type='text'],input[type='radio'],input[type='checkbox']",function(e){13==e.keyCode&&e.preventDefault()}),$("#left_Selected_1").click(function(){$("#mSelectRight :selected").map(function(e,t){Boolean($(t).attr("mandatory"))||($("#mSelectLeft").append($("<option>",{value:$(this).val(),text:$(this).text()})),$(this).remove())})}),$("#right_All_1").click(function(){$("#mSelectLeft option").map(function(e,t){Boolean($(t).attr("mandatory"))||($("#mSelectRight").append($("<option>",{value:$(this).val(),text:$(this).text()})),$(this).remove())})}),$("#left_All_1").click(function(){$("#mSelectRight option").map(function(e,t){Boolean($(t).attr("mandatory"))||($("#mSelectLeft").append($("<option>",{value:$(this).val(),text:$(this).text()})),$(this).remove())})}),$("#reorder").on("click",function(e){try{impFldsReOrder()}catch(error){showAlertDialog("error",error.message)}}),$("body").on("click",function(e){$("[data-bs-toggle=popover]").each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})}).on("hidden.bs.popover",function(e){$(e.target).popover("hide")}),$("#ddlImpTbl").change(function(){ShowDimmer(!0)}),$("#spnFileSelect").keypress(function(e){13==e.keyCode&&$("#fileToUpload").click()}),$("#fileToUpload").attr("title",eval(callParent("lcm[66]"))),$("#ddlSeparator").change(function(){$("#hdnUploadFileWarnings, #IsFileUploaded").val(""),$("#noFile").text(eval(callParent("lcm[66]"))),$("#fileToUpload").attr("title",eval(callParent("lcm[66]"))),$("#divProgress").hide(),$("[data-target='imWizardEdit']").removeClass("in-progress complete"),$("[data-target='imWizardSummary']").removeClass("in-progress complete"),$("[data-target='imWizardUpload']").addClass("in-progress").removeClass("complete")}),mandatoryColCount=$("#mSelectRight option[mandatory='true']").length,$("#hdnMandatoryColCount").val(mandatoryColCount);var mandatoryFldVal="",mandatoryFldCap="";$("#mSelectRight option[mandatory='true']").each(function(){mandatoryFldVal+=$(this).val()+",",mandatoryFldCap+=$(this).text()+","}),""!=mandatoryFldVal&&""!=mandatoryFldCap&&(mandatoryFldVal=mandatoryFldVal.substr(0,mandatoryFldVal.length-1),mandatoryFldCap=mandatoryFldCap.substr(0,mandatoryFldCap.length-1)),$("#hdnMandatoryFields").val(mandatoryFldVal+"#"+mandatoryFldCap),$("#wizardWrappper .stepName").each(function(){$(this).prop("title",$(this).text()),$(this).next().prop("title",$(this).text())});try{var _KTApp2,headerFooter=$(callParentNew("modal-header","class")).outerHeight(!0)+$(".stepper>.card-header").outerHeight(!0)+$(".stepper>.card-footer").outerHeight(!0);$(".stepper>.card-body").css("height","calc(100vh - ".concat(headerFooter,"px)")),null===(_KTApp2=KTApp)||void 0===_KTApp2||_KTApp2.initBootstrapTooltips()}catch(ex){}});var AxRulesDefScriptOnLoad="false",AxRuesDefScriptFormcontrol="false",AxRuesDefScriptFCP="false",AxAllowEmptyFlds=new Array,transid="",Parameters=new Array,AxMemParameters=new Array,AxRDFormControl=new Array,AxRDScriptOnLoad=new Array,FNames=new Array,DCFrameNo=new Array,TstructHasPop=!1,AxActiveDc="",AxFormControlList=new Array,AxOldValueOnChange="";function CheckAxRulesForImport(){var e=$("#axRuleDetails").val();if(void 0!==e&&""!=e){var t=e.split("~");AxRulesDefScriptOnLoad=t[0],AxRuesDefScriptFormcontrol=t[2];var l=$("#axRuleScript").val();""!=l&&(AxRDFormControl=l.split("♠"));var a=$("#axRuleOnSubmit").val();""!=a&&(AxRDScriptOnLoad=a.split("♠")),"true"==AxRulesDefScriptOnLoad&&AxRulesScriptsParser("scriptonload"),"true"==AxRuesDefScriptFormcontrol&&AxRulesScriptsParser("formcontrol"),AxAllowEmptyFlds.length>0&&AxRuleSetMandatory()}}function AxRulesScriptsParser(e){switch(e){case"formcontrol":$.each(AxRDFormControl,function(e,t){if(""!=t){var l=t.split("♥");EvalExprSet(l)}});break;case"scriptonload":$.each(AxRDScriptOnLoad,function(e,t){if(t){var l=t.split("♥");EvalExprSet(l)}});break;default:return!0}}function AxRuleSetMandatory(){try{$.ajax({url:"importnew.aspx/AxRuleSetMandatory",type:"POST",cache:!1,async:!1,data:JSON.stringify({AxAllowEmpty:AxAllowEmptyFlds}),dataType:"json",contentType:"application/json",success:function(e){if("done"==e.d){$("#mSelectLeft").empty(),$("#mSelectRight").empty();var t="",l=$("#hdnLeftFlds").val();""!=l&&(l.split(",").forEach(function(e){var l=e.split("(")[1].split(")")[0],a=e.split("(")[0];a=a.replace("*","");var r=AxAllowEmptyFlds.filter(function(e){return e.startsWith(l+"~")}),n=e;r.length>0&&"F"==r[0].split("~")[1]?n=a+"*("+l+")":r.length>0&&"T"==r[0].split("~")[1]&&(n=a+"("+l+")"),$("#mSelectLeft").append('<option value="'+l+'">'+n+"</option>"),""==t?t=n:t+=","+n}),setTimeout(function(){updateMandatoryFieldsToSelection()},0)),""!=t&&$("#hdnLeftFlds").val(t)}},error:function(e){}})}catch(e){}}function ShowImportError(e){ShowDimmer(!1),showAlertDialog("error",e)}