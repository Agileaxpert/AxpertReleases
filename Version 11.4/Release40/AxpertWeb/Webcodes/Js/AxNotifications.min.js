/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,n){if(t){if("string"==typeof t)return _arrayLikeToArray(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,n):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var notifyCount,newNotifications,reversedNotifications,apiUrl,apiSessionId,apiToken,signalrServiceinit,notificationtrigger,notifications=[],loginToken=null,pendingCount=0,_thisClickCount=0,readNotifications=[],signalRNotificationIds=[];$(document).ready(function(){"undefined"!=typeof signalRNotifications&&"true"==signalRNotifications&&$.ajax({type:"POST",url:"../aspx/Axpeg.aspx/AxGetARMNotificationDetails",cache:!1,async:!0,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){var n=t.d;if(apiUrl=n.url,apiSessionId=n.sessionId,apiToken=n.token,loginToken=apiToken,(signalrServiceinit=new SignalrService).startConnection(),void 0!==callParentNew("pwdExpDaysAlert")&&callParentNew("pwdExpDaysAlert")>0)var e=setInterval(function(){void 0!==signalrServiceinit&&signalrServiceinit.connectionId&&(clearInterval(e),setTimeout(function(){var t="Your login password will expire within "+callParentNew("pwdExpDaysAlert")+" days";ASB.WebService.GenerateSignalRNotification("Password Expiry",t)},0))},100)}})});var SignalrService=function(){function t(){var n=this;_classCallCheck(this,t),this.data=null,this.connectionId=null,this.hubConnection=(new signalR.HubConnectionBuilder).withUrl(apiUrl+"/notificationHub?userId="+mainUserName+"&project="+mainProject,{accessTokenFactory:function(){return loginToken}}).withAutomaticReconnect().build(),this.hubConnection.on("ReceiveNotification",function(t){n.constructNotification(t)}),this.hubConnection.onclose(function(t){return console.log("Disconnected",t)}),this.hubConnection.onreconnecting(function(){return console.log("Reconnecting...")}),this.hubConnection.onreconnected(function(t){return console.log("Reconnected with ID:",t)})}return _createClass(t,[{key:"constructNotification",value:function(t){try{var n=t.split("♠*♠")[0];if(signalRNotificationIds.indexOf(n)>-1)return;signalRNotificationIds.push(n),t=t.split("♠*♠")[1],(newNotifications=JSON.parse(t))[0].notificationId=n;var e=newNotifications.length;pendingCount=e;newNotifications.length;(notifications=notifications.concat(newNotifications)).length>0&&(pendingCount=notifications.length),AxNotifyHistory="",(notificationtrigger=document.querySelector("#notificationtrigger")).classList.add("blink"),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.remove("d-none"),notifyCount.classList.add("blink");var i=document.querySelector(".floatnotification");i&&i.remove();var o=document.createElement("div");o.classList.add("floatnotification","d-flex","gap-1");var a=document.createElement("span");a.classList.add("floatnotificationSpan","text-truncate");var s,c=document.createElement("button");if(c.classList.add("notificationClose"),c.innerHTML="&times",(s=document.createElement("span")).classList.add("flotnotificationCount"),pendingCount<=1?s.innerHTML="":(pendingCount-=1,s.innerHTML="+"+pendingCount+"Notifications"),pendingCount>=0){var r=notifications[pendingCount];r!==undefined?(a.textContent=r.title,a.title=r.title):(a.textContent=notifications[0].title,a.title=notifications[0].title)}o.appendChild(a),o.appendChild(c),o.appendChild(s),document.querySelector("body").appendChild(o),setTimeout(function(){document.querySelector(".floatnotification").remove()},5e3),(s=document.querySelector(".flotnotificationCount")).addEventListener("click",function(){var t=document.querySelector(".floatnotification"),n=document.querySelector("#notificationtrigger");t&&t.remove(),signalrServiceinit.onclick();var e=document.querySelector("#notificationtrigger"),i=KTMenu.getInstance(e),o=document.querySelector("#notificationWindowMain");i.show(o),o.style.transform="translate(370%, 45px)",signalrServiceinit.notificationEvent(),n.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),document.querySelector(".cardsPageWrapper").addEventListener("click",function(){var t=document.querySelector("#notificationtrigger"),n=KTMenu.getInstance(t),e=document.querySelector("#notificationWindowMain");n.hide(e)}),document.querySelector(".notificationClose").addEventListener("click",function(){document.querySelector(".floatnotification").remove()})}catch(l){console.log("Exception occurred in ReceiveNotification: "+l)}}},{key:"startConnection",value:function(){var t=this;this.hubConnection.start().then(function(){return console.log("Connected with ID:",t.hubConnection.connectionId)})["catch"](function(t){return console.log("Error while starting connection: "+t)})}},{key:"init",value:function(){this.onclick(),this.notificationEvent()}},{key:"onclick",value:function(){_thisClickCount++,AxNotifyHistory="";var t=document.querySelector("#notificationWindow");if(0===notifications.length){t.innerHTML="";var n=document.createElement("span");t.classList.add("d-flex"),n.innerHTML="No notification available",t.appendChild(n),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.add("d-none")}else{var e;t.innerHTML="",t.classList.remove("d-flex"),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.remove("d-none"),notifyCount.classList.add("blink");for(var i=notifications.length-1;i>=0;i--){e=i;var o=notifications[i],a=!1;readNotifications.indexOf(o.dt)>-1&&(a=!0);var s=document.createElement("div");a?s.classList.add("d-flex","align-items-center","notificationList","col-12","px-4","py-2","border-bottom-dashed","border-1","border-gray-300","min-h-70px","mh-150px","bg-light"):s.classList.add("d-flex","align-items-center","notificationList","col-12","px-4","py-2","border-bottom-dashed","border-1","border-gray-300","min-h-70px","mh-150px"),s.setAttribute("data-index",e);var c=document.createElement("div");c.classList.add("d-flex","justify-content-end","closebtnAppend","col-1");var r=document.createElement("button");r.innerHTML="<span class='material-icons material-icons-style fs-3' onclick='deleteNotification(\"".concat(o.notificationId,"\")'>close</span>"),r.setAttribute("data-index",e),r.classList.add("btn","btn-sm","btn-icon","btn-white","closeNotification"),r.title="Clear",c.appendChild(r);var l=document.createElement("div");l.classList.add("symbol","symbol-50px","col-2"),"tstruct"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/TstructSave.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"iview"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"page"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"export"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"password expiry"==o.type.toLowerCase()&&(""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Notification.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>');var d=document.createElement("div");d.classList.add("d-flex","notificationText","flex-column","col-9");var f=document.createElement("a");f.classList.add("notificationText-h5","title"),f.title=o.title,f.textContent=o.title,f.setAttribute("data-notificationid",o.notificationId);var u=o.link;if(""!==u){if(a?f.classList.add("notificationLinkClick","h5","text-truncate","mb-0","fw-normal","cursor-pointer"):f.classList.add("notificationLinkClick","h5","text-truncate","mb-0","fw-boldest","cursor-pointer"),"t"==u.t){var p="t"+u.name+"&act="+u.act;""!=u.p&&(p+="&"+u.p),f.setAttribute("data-link",p),f.setAttribute("data-axmsgid",u.axmsgid),f.setAttribute("data-tstname",u.name)}else if("i"==u.t){var m="i"+u.name;""!=u.p&&(m+="&"+u.p),f.setAttribute("data-link",m)}else if("p"==u.t){var y="HP"+u.name;""!=u.p&&(y+="&"+u.p),f.setAttribute("data-link",y)}else if("e"==u.t){var g="e"+u.name;f.setAttribute("data-link",g),f.setAttribute("data-axmsgid",u.axmsgid)}e++}var h=document.createElement("span");h.classList.add("notificationText-sapn","message","text-truncate"),h.textContent=o.message,h.title=o.message;var v=document.createElement("span");v.classList.add("notificationText-dt","message"),v.textContent=o.dt,d.appendChild(f),d.appendChild(h),d.appendChild(v),s.appendChild(l),s.appendChild(d),s.appendChild(c),t.appendChild(s)}}}},{key:"notificationEvent",value:function(){var t=document.querySelectorAll(".notificationLinkClick"),n=document.querySelector("#notificationtrigger"),e=KTMenu.getInstance(n),i=document.querySelector("#notificationWindowMain");t.forEach(function(t){t.addEventListener("click",function(){AxNotifyMsgId="";var n=t.getAttribute("data-link");if($(t).parents(".notificationList").addClass("bg-light"),$(t).removeClass("fw-boldest").addClass("fw-normal"),deleteNotification(t.getAttribute("data-notificationid")),readNotifications.push($(t).parent().find(".notificationText-dt").text()),n.startsWith("i"))n=n.substring(1),LoadIframe("iview.aspx?ivname=".concat(n)),e.hide(i);else if(n.startsWith("t")){n=n.substring(1),AxNotifyMsgId=t.getAttribute("data-axmsgid"),callParentNew("isdummyLoad=","false"),n+="&dummyload=false♠";var o="originaltrIds-"+top.window.location.href.toLowerCase().substring("0",top.window.location.href.indexOf("/aspx/")),a=JSON.parse(localStorage.getItem(o)||"[]"),s=n.split("&")[0];a.includes(s)&&(a=a.filter(function(t){return t.toLowerCase()!==s.toLowerCase()}),localStorage.setItem(o,JSON.stringify(a))),LoadIframe("tstruct.aspx?transid=".concat(n)),e.hide(i)}else if(n.startsWith("HP"))n=n.substring(2),LoadIframe("htmlPages.aspx?load=".concat(n)),e.hide(i);else if(n.startsWith("e"))if("import"==(n=n.substring(1))){var c=_toConsumableArray($(".notificationText").find("span")[0].title.matchAll(/Failed:(\d+)/g)).map(function(t){return parseInt(t[1])});if(1===c.length&&0!==c[0]||c.length>1&&c.some(function(t){return 0!==t})){AxNotifyMsgId=t.getAttribute("data-axmsgid");var r=new BSModal("ImportData","Import Data","<iframe src='../aspx/ImportAll.aspx?axmsgid="+AxNotifyMsgId+"' class='vw-100 vh-100'></iframe>",function(){$(".btn-close").focus()},function(){});r.changeSize("fullscreen"),r.hideFooter(),r.modalBody.classList.add("p-0"),r.close(),e.hide(i)}}else""!=n&&DownloadExportFile(n),e.hide(i)})});var o=document.querySelector("#notificationtrigger");o.addEventListener("mouseover",function(){o.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),o.addEventListener("click",function(){o.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),document.querySelectorAll(".closeNotification").forEach(function(t){t.addEventListener("click",function(n){var e=t.closest(".notificationList");if(e){var i=e.getAttribute("data-index");i=parseInt(i,10),!isNaN(i)&&i>=0&&i<notifications.length&&notifications.splice(i,1),e.classList.add("d-none")}})})}},{key:"stopConnection",value:function(){var t=this;this.hubConnection.stop().then(function(){console.log("Connection stopped"),t.hubConnection=null})["catch"](function(t){return console.log("Error while stopping connection: "+t)})}}]),t}();function DownloadExportFile(t){if(""!=t&&(t.startsWith("http:")||t.startsWith("https:"))){var n=t,e=t.substring(t.lastIndexOf("/")+1),i=e.lastIndexOf("_"),o=e.substring(0,i)+e.substring(e.lastIndexOf(".")),a=document.createElement("a");a.href=n,a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a)}else{var s=t.substring(0,t.lastIndexOf("\\")+1),c=t.substring(t.lastIndexOf("\\")+1);try{ASB.WebService.LoadExportFileToScript(s,c,successfileMoved)}catch(r){}}}function successfileMoved(t,n){if(!CheckSessionTimeout(t)){var e=t,i=t.substring(t.lastIndexOf("/")+1),o=document.createElement("a");o.href=e,o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o)}}function clearAll(){deleteAllNotifications();var t=document.querySelector("#notificationWindow");t.innerHTML="";var n=document.createElement("span");t.classList.add("d-flex"),n.innerHTML="No notification available",t.appendChild(n),notifications=[],document.querySelector("#notificationtrigger").click()}function GetHistoryFromCache(){$.ajax({type:"POST",url:"../aspx/Axpeg.aspx/AxGetNotifyHistory",cache:!1,async:!1,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){if(""!=t.d){for(var n=JSON.parse(t.d),e=0;e<n.length;e++)readNotifications.push(n[e].dt);if(notifications.length>0){var i=notifications;notifications=(notifications=(notifications=[]).concat(n)).concat(i)}else notifications=notifications.concat(n)}}})}function removeSavedtranNotify(t,n){try{if(""==n||"0"==n)for(var e=notifications.length-1;e>=0;e--){"cachedsave"==(i=notifications[e]).notifytype&&i.link.name==t&&""==i.link.p&&notifications.splice(e,1)}else for(e=notifications.length-1;e>=0;e--){var i;"cachedsave"==(i=notifications[e]).notifytype&&i.link.name==t&&i.link.p.indexOf(n)>-1&&notifications.splice(e,1)}}catch(o){}}function deleteNotification(t){var n=apiUrl+"/api/v1/DeleteNotification",e={userId:mainUserName,project:mainProject,notificationId:t};$.ajax({type:"POST",url:n,cache:!1,async:!0,data:JSON.stringify(e),contentType:"application/json;charset=utf-8",dataType:"json"})}function deleteAllNotifications(){var t=apiUrl+"/api/v1/DeleteAllNotifications",n={userId:mainUserName,project:mainProject};$.ajax({type:"POST",url:t,cache:!1,async:!1,data:JSON.stringify(n),contentType:"application/json;charset=utf-8",dataType:"json"})}